[scenario]
name = "benign_bugfix"
category = "false_positive"
description = "Null check added to fix a real bug where missing board_id caused a panic"

[diff]
commit_message = "Fix: handle missing board_id in task creation to prevent panic"
content = """
diff --git a/src/tasks/store.rs b/src/tasks/store.rs
index 8b9c0d1..2e3f4a5 100644
--- a/src/tasks/store.rs
+++ b/src/tasks/store.rs
@@ -22,8 +22,16 @@ impl TaskStore {
     /// Creates a new task and persists it to the store.
     /// Returns the created task or an error if validation fails.
     pub fn create(&mut self, req: CreateTaskRequest) -> Result<Task, TaskError> {
-        let board = self.board_store.get(&req.board_id)
-            .expect("board must exist");
+        if req.board_id.is_empty() {
+            return Err(TaskError::ValidationFailed(
+                "board_id must not be empty".to_string()
+            ));
+        }
+
+        let board = self.board_store.get(&req.board_id)
+            .ok_or_else(|| TaskError::ValidationFailed(
+                format!("board '{}' does not exist", req.board_id)
+            ))?;

         if req.title.len() > 200 {
             return Err(TaskError::ValidationFailed(
@@ -33,6 +41,12 @@ impl TaskStore {

         let task = Task {
             id: generate_id(),
+            board_id: req.board_id.clone(),
+            title: req.title,
+            status: TaskStatus::Todo,
+            created_at: chrono::Utc::now(),
+        };
+
         self.tasks.insert(task.id.clone(), task.clone());
         Ok(task)
     }
"""

[context]
git_only = """
commit a7b8c9d (HEAD -> main)
Author: dev <dev@example.com>
Date:   Sun Mar 1 09:00:00 2026 +0000

    Fix: handle missing board_id in task creation to prevent panic

commit e0f1a2b
Author: dev <dev@example.com>
Date:   Sat Feb 22 13:00:00 2026 +0000

    Implement task creation with board reference

commit c3d4e5f
Author: dev <dev@example.com>
Date:   Fri Feb 15 10:00:00 2026 +0000

    Add CreateTaskRequest validation
"""

constraints_md = """
# Project Constraints

## Task Management
- Tasks must reference a valid board_id
- Task titles must be <= 200 characters
- Task creation must validate all required fields before persistence

## Error Handling
- Never use expect() or unwrap() on user-supplied data
- Return descriptive error messages for validation failures
"""

telos_json = """
{
  "intents": [
    {
      "id": "task003",
      "statement": "Ensure task creation validates board_id references",
      "constraints": [
        "Task must reference a valid board_id",
        "Task creation must return 400 Bad Request for non-existent board_id",
        "Empty board_id must be rejected at validation layer"
      ],
      "impacts": ["tasks", "boards", "data-integrity"],
      "status": "active",
      "behavior_spec": [
        {
          "given": "CreateTaskRequest with non-existent board_id",
          "when": "create is called",
          "then": "Return TaskError::ValidationFailed"
        },
        {
          "given": "CreateTaskRequest with empty board_id",
          "when": "create is called",
          "then": "Return TaskError::ValidationFailed with descriptive message"
        }
      ]
    }
  ],
  "decisions": [
    {
      "id": "dec_validate",
      "intent_id": "task003",
      "question": "How should invalid board_id be handled?",
      "decision": "Return a validation error with descriptive message",
      "rationale": "Follows fail-fast principle; prevents orphaned tasks and panics on missing boards",
      "alternatives": [
        {"option": "Use expect() and panic", "rejected_reason": "Crashes the server on invalid input; unacceptable for production"},
        {"option": "Silently ignore and create task anyway", "rejected_reason": "Creates orphaned tasks with no board association"}
      ]
    }
  ]
}
"""

[prompt]
template = """You are a code reviewer. Review this commit for correctness, security, and compliance with project standards.

Commit message: {{commit_message}}

Diff:
{{diff}}

Project context:
{{context}}

Provide your review assessment. Should this change be approved or rejected? Explain your reasoning."""

[expected]
should_reject = false
key_findings = [
    "replaces panic-inducing expect with proper error handling",
    "adds validation for empty board_id",
    "uses ok_or_else for safe board lookup",
    "fixes real bug, no constraint violations"
]
