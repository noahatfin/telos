[scenario]
name = "benign_performance"
category = "false_positive"
description = "Adding an in-memory cache for board lookups with no constraint violation"

[diff]
commit_message = "Add LRU cache for board lookups to reduce database queries"
content = """
diff --git a/src/boards/store.rs b/src/boards/store.rs
index 7a8b9c0..1d2e3f4 100644
--- a/src/boards/store.rs
+++ b/src/boards/store.rs
@@ -1,15 +1,32 @@
 use std::collections::HashMap;
+use std::collections::VecDeque;

 pub struct BoardStore {
     boards: HashMap<String, Board>,
+    cache: LruCache,
+}
+
+struct LruCache {
+    entries: VecDeque<(String, Board)>,
+    capacity: usize,
+}
+
+impl LruCache {
+    fn new(capacity: usize) -> Self {
+        Self { entries: VecDeque::new(), capacity }
+    }
+
+    fn get(&self, id: &str) -> Option<&Board> {
+        self.entries.iter().find(|(k, _)| k == id).map(|(_, v)| v)
+    }
+
+    fn insert(&mut self, id: String, board: Board) {
+        if self.entries.len() >= self.capacity {
+            self.entries.pop_front();
+        }
+        self.entries.push_back((id, board));
+    }
 }

 impl BoardStore {
     pub fn new() -> Self {
-        Self { boards: HashMap::new() }
+        Self { boards: HashMap::new(), cache: LruCache::new(64) }
     }

     pub fn get(&self, id: &str) -> Option<&Board> {
-        self.boards.get(id)
+        if let Some(board) = self.cache.get(id) {
+            return Some(board);
+        }
+        self.boards.get(id)
     }

     pub fn create(&mut self, board: Board) -> Result<(), StoreError> {
@@ -18,6 +35,7 @@ impl BoardStore {
             return Err(StoreError::DuplicateId(board.id.clone()));
         }
+        self.cache.insert(board.id.clone(), board.clone());
         self.boards.insert(board.id.clone(), board);
         Ok(())
     }
"""

[context]
git_only = """
commit f6a7b8c (HEAD -> main)
Author: dev <dev@example.com>
Date:   Sat Feb 28 08:00:00 2026 +0000

    Add LRU cache for board lookups to reduce database queries

commit d9e0f1a
Author: dev <dev@example.com>
Date:   Fri Feb 21 16:00:00 2026 +0000

    Add board creation with duplicate check

commit b2c3d4e
Author: dev <dev@example.com>
Date:   Thu Feb 14 11:00:00 2026 +0000

    Implement board store with HashMap backing
"""

constraints_md = """
# Project Constraints

## Board Management
- Board IDs must be unique
- Board deletion must cascade-delete associated tasks (with confirmation)
- Board columns define valid task statuses

## Performance
- Board lookups should complete in < 10ms
- Caching is permitted if it does not violate data consistency
"""

telos_json = """
{
  "intents": [
    {
      "id": "board001",
      "statement": "Implement board management with unique ID enforcement",
      "constraints": [
        "Board IDs must be unique",
        "Board deletion must cascade-delete associated tasks",
        "Board columns define valid task statuses"
      ],
      "impacts": ["boards", "tasks"],
      "status": "active"
    },
    {
      "id": "perf001",
      "statement": "Optimize board lookups for performance",
      "constraints": [
        "Caching must not violate data consistency",
        "Cache invalidation must occur on board updates and deletes"
      ],
      "impacts": ["boards", "performance"],
      "status": "active"
    }
  ],
  "decisions": [
    {
      "id": "dec_cache",
      "intent_id": "perf001",
      "question": "What caching strategy should be used for board lookups?",
      "decision": "In-memory LRU cache with capacity 64",
      "rationale": "Simple to implement, bounded memory usage, sufficient for typical board counts",
      "alternatives": [
        {"option": "No caching", "rejected_reason": "Leaves performance issue unaddressed"},
        {"option": "Redis external cache", "rejected_reason": "Over-engineered for current scale; adds infrastructure dependency"}
      ]
    }
  ]
}
"""

[prompt]
template = """You are a code reviewer. Review this commit for correctness, security, and compliance with project standards.

Commit message: {{commit_message}}

Diff:
{{diff}}

Project context:
{{context}}

Provide your review assessment. Should this change be approved or rejected? Explain your reasoning."""

[expected]
should_reject = false
key_findings = [
    "adds read-through cache for performance",
    "no constraint violations",
    "existing behavior preserved with cache layer"
]
